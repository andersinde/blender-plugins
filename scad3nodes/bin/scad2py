#!/bin/sh

# convert all .scad files in /tmp/scad/ to .csg
# then convert them to python using parse.cpp
mkdir -p /tmp/scad
# echo "def get_output_nodes(group, Node):" > /tmp/nodes.py
# echo      "\tnodes = dict()" 		 >> /tmp/nodes.py

echo "\nscad2py\n"
echo "# generated by scad2py" > /tmp/nodes.py

FILES="/tmp/scad/*"
for f in $FILES
do
	name=$(basename -- "$f" .scad)
	echo "Processing $name"
	OpenSCAD $f -o $f.csg
	# parse $name < $f.csg > $f.py
	echo "\ndef get_output_node_$name(group, Node):" >> /tmp/nodes.py
	parse $name < $f.csg >> /tmp/nodes.py
	rm $f.csg
done

echo "\ndef get_output_node():" >> /tmp/nodes.py
echo "\treturn {" >> /tmp/nodes.py
for f in $FILES
do
	name=$(basename -- "$f" .scad)
	echo "\t\t\"$name\": get_output_node_$name," >> /tmp/nodes.py
done
echo "\t}" >> /tmp/nodes.py

rm /tmp/scad/*

echo "/tmp/nodes.py" > /tmp/blender_tmp.io
